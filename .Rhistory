}))
ef_m <- matrix(ef_m, ncol = length(ef$sp), byrow = T)
colnames(ef_m) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(ef_m) <- nevek
#fajok szerinti gyujtott egyedek szama
ef <- unique(dat[,6:13])
aktivi3 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(x$fajok$sp) != 0) {
for (i in 1:length(x$fajok$sp)) {
d1[1,paste(x$fajok$sp[i])] <- d1[1,paste(x$fajok$sp[i])] + x$fajok[i,]$egyed
}
}
return(d1)
}))
aktivitas3 <- matrix(aktivi3, ncol = length(ef$sp), byrow = T)
colnames(aktivitas3) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(aktivitas3) <- nevek
}
}
asd <- c('regi_fl', 'uj_regi_fl')
asd2 <- c('nevek', 'uj_nevek')
for (i in 1:length(asd)) {
{
#regionkenti egyedek lekerdezese honaponkent
aktivi <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- numeric(12)
for (i in 1:length(x$fajok$datum)) {
d[month(x$fajok[i,]$datum)] <- d[month(x$fajok[i,]$datum)] + x$fajok[i,]$egyed
}
return(d)
}))
aktivitas <- matrix(c(aktivi), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas) <- honapok
rownames(aktivitas) <- eval(as.name(paste(asd2[i])))
#honaponkenti gyujtesi napok szama regionkent
aktivi1 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- unique(x$fajok$datum)
d <- numeric(12)
for (i in 1:length(d1)) {
d[month(d1[i])] <- d[month(d1[i])] + 1
}
return(d)
}))
aktivitas1 <- matrix(c(aktivi1), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas1) <- honapok
rownames(aktivitas1) <- eval(as.name(paste(asd2[i])))
#honaponkenti fajok szama regionkent
aktivi2 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- data.frame(d = month(x$fajok$datum), f = x$fajok$sp)
d1 <- unique(d1[,c(1,2)])
d <- numeric(12)
for (i in 1:length(d1[,2])) {
d[month(d1[i, 1])] <- d[month(d1[i, 1])] + 1
}
return(d)
}))
aktivitas2 <- matrix(c(aktivi2), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas2) <- honapok
rownames(aktivitas2) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtese szama regionkent
#aa <- ddply(eval(as.name(paste(asd[i])))[[2]]$fajok, .(sp), nrow)
ef <- unique(dat[,6:13])
ef_m <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- ddply(x$fajok, .(sp), nrow)
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(d$sp) != 0) {
for (i in 1:length(d$sp)) {
d1[1,paste(d$sp[i])] <- d$V1[i]
}
}
return(d1)
}))
ef_m <- matrix(ef_m, ncol = length(ef$sp), byrow = T)
colnames(ef_m) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(ef_m) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtott egyedek szama
ef <- unique(dat[,6:13])
aktivi3 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(x$fajok$sp) != 0) {
for (i in 1:length(x$fajok$sp)) {
d1[1,paste(x$fajok$sp[i])] <- d1[1,paste(x$fajok$sp[i])] + x$fajok[i,]$egyed
}
}
return(d1)
}))
aktivitas3 <- matrix(aktivi3, ncol = length(ef$sp), byrow = T)
colnames(aktivitas3) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(aktivitas3) <- eval(as.name(paste(asd2[i])))
}
}
eval(as.name(paste(asd[1])))$adatok
eval(as.name(paste(asd[1])))[[1]]
uj_df <- data.frame(matrix(vector(), 0, 6, dimnames = list(c(), c('regio', 'terulet', 'teles_fajszam', 'korrekcios_fajszam', 'gyujtesi_pontok_sz', 'egyedszam'))), stringsAsFactors=F)
for (i in 1:length(uj_regi_fl)) {
uj_df[i,]$regio <- uj_nevek[i]
uj_df[i,]$terulet <- uj_regi_fl[[i]]$adatok$terulet
uj_df[i,]$teles_fajszam <- uj_regi_fl[[i]]$adatok$telj_fsz
uj_df[i,]$korrekcios_fajszam <- uj_regi_fl[[i]]$adatok$corr_fsz
uj_df[i,]$gyujtesi_pontok_sz <- uj_regi_fl[[i]]$adatok$gyujtesi_pontok_sz
uj_df[i,]$egyedszam <- uj_regi_fl[[i]]$adatok$egyedszam
}
uj_df
asd3 <- c('df', 'uj_df')
paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx")
paste("tipulidae_eredmenyek_", paste(asd[1]), ".xlsx")
paste("tipulidae_eredmenyek_", paste(asd[1]), ".xlsx", sep = "")
{
asd <- c('regi_fl', 'uj_regi_fl')
asd2 <- c('nevek', 'uj_nevek')
asd3 <- c('df', 'uj_df')
asd4 <- c('nPolys', 'uj_nPolys')
#eval(as.name(paste(asd[i])))
#lehet olyat is csinalni hogy eval(as.name(paste(asd[1])))[[2]]$adatok
for (i in 1:length(asd)) {
#lekerdezesek
{
#regionkenti egyedek lekerdezese honaponkent
aktivi <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- numeric(12)
for (i in 1:length(x$fajok$datum)) {
d[month(x$fajok[i,]$datum)] <- d[month(x$fajok[i,]$datum)] + x$fajok[i,]$egyed
}
return(d)
}))
aktivitas <- matrix(c(aktivi), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas) <- honapok
rownames(aktivitas) <- eval(as.name(paste(asd2[i])))
#honaponkenti gyujtesi napok szama regionkent
aktivi1 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- unique(x$fajok$datum)
d <- numeric(12)
for (i in 1:length(d1)) {
d[month(d1[i])] <- d[month(d1[i])] + 1
}
return(d)
}))
aktivitas1 <- matrix(c(aktivi1), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas1) <- honapok
rownames(aktivitas1) <- eval(as.name(paste(asd2[i])))
#honaponkenti fajok szama regionkent
aktivi2 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- data.frame(d = month(x$fajok$datum), f = x$fajok$sp)
d1 <- unique(d1[,c(1,2)])
d <- numeric(12)
for (i in 1:length(d1[,2])) {
d[month(d1[i, 1])] <- d[month(d1[i, 1])] + 1
}
return(d)
}))
aktivitas2 <- matrix(c(aktivi2), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas2) <- honapok
rownames(aktivitas2) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtese szama regionkent
#aa <- ddply(eval(as.name(paste(asd[i])))[[2]]$fajok, .(sp), nrow)
ef <- unique(dat[,6:13])
ef_m <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- ddply(x$fajok, .(sp), nrow)
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(d$sp) != 0) {
for (i in 1:length(d$sp)) {
d1[1,paste(d$sp[i])] <- d$V1[i]
}
}
return(d1)
}))
ef_m <- matrix(ef_m, ncol = length(ef$sp), byrow = T)
colnames(ef_m) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(ef_m) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtott egyedek szama
ef <- unique(dat[,6:13])
aktivi3 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(x$fajok$sp) != 0) {
for (i in 1:length(x$fajok$sp)) {
d1[1,paste(x$fajok$sp[i])] <- d1[1,paste(x$fajok$sp[i])] + x$fajok[i,]$egyed
}
}
return(d1)
}))
aktivitas3 <- matrix(aktivi3, ncol = length(ef$sp), byrow = T)
colnames(aktivitas3) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(aktivitas3) <- eval(as.name(paste(asd2[i])))
}
#7
{
for (j in 1:length(eval(as.name(paste(asd4[i]))))) {
if (eval(as.name(paste(asd[i])))[[j]]$adatok$telj_fsz != 0) {
write.xlsx(eval(as.name(paste(asd[i])))[[j]]$fajok, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = eval(as.name(paste(asd3[i])))[j,]$regio, append = TRUE, showNA = F)
}
}
write.xlsx(eval(as.name(paste(asd3[i]))), file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Regionkenti adatok', append = TRUE, showNA = F)
write.xlsx(aktivitas, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkent gyujtott egyedek', append = TRUE, showNA = F)
write.xlsx(aktivitas1, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti gyujtesi napok szama', append = TRUE, showNA = F)
write.xlsx(aktivitas2, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti fajok szama', append = TRUE, showNA = F)
write.xlsx(ef_m, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtese szama', append = TRUE, showNA = F)
write.xlsx(aktivitas3, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtott egyedek szama', append = TRUE, showNA = F)
} #exportalas
}
} #tabalzatok lekerdezesek
{
asd <- c('regi_fl', 'uj_regi_fl')
asd2 <- c('nevek', 'uj_nevek')
asd3 <- c('df', 'uj_df')
asd4 <- c('nPolys', 'uj_nPolys')
#eval(as.name(paste(asd[i])))
#lehet olyat is csinalni hogy eval(as.name(paste(asd[1])))[[2]]$adatok
for (i in 1:length(asd)) {
#lekerdezesek
{
#regionkenti egyedek lekerdezese honaponkent
aktivi <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- numeric(12)
for (i in 1:length(x$fajok$datum)) {
d[month(x$fajok[i,]$datum)] <- d[month(x$fajok[i,]$datum)] + x$fajok[i,]$egyed
}
return(d)
}))
aktivitas <- matrix(c(aktivi), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas) <- honapok
rownames(aktivitas) <- eval(as.name(paste(asd2[i])))
#honaponkenti gyujtesi napok szama regionkent
aktivi1 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- unique(x$fajok$datum)
d <- numeric(12)
for (i in 1:length(d1)) {
d[month(d1[i])] <- d[month(d1[i])] + 1
}
return(d)
}))
aktivitas1 <- matrix(c(aktivi1), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas1) <- honapok
rownames(aktivitas1) <- eval(as.name(paste(asd2[i])))
#honaponkenti fajok szama regionkent
aktivi2 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- data.frame(d = month(x$fajok$datum), f = x$fajok$sp)
d1 <- unique(d1[,c(1,2)])
d <- numeric(12)
for (i in 1:length(d1[,2])) {
d[month(d1[i, 1])] <- d[month(d1[i, 1])] + 1
}
return(d)
}))
aktivitas2 <- matrix(c(aktivi2), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas2) <- honapok
rownames(aktivitas2) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtese szama regionkent
#aa <- ddply(eval(as.name(paste(asd[i])))[[2]]$fajok, .(sp), nrow)
ef <- unique(dat[,6:13])
ef_m <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- ddply(x$fajok, .(sp), nrow)
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(d$sp) != 0) {
for (i in 1:length(d$sp)) {
d1[1,paste(d$sp[i])] <- d$V1[i]
}
}
return(d1)
}))
ef_m <- matrix(ef_m, ncol = length(ef$sp), byrow = T)
colnames(ef_m) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(ef_m) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtott egyedek szama
ef <- unique(dat[,6:13])
aktivi3 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(x$fajok$sp) != 0) {
for (i in 1:length(x$fajok$sp)) {
d1[1,paste(x$fajok$sp[i])] <- d1[1,paste(x$fajok$sp[i])] + x$fajok[i,]$egyed
}
}
return(d1)
}))
aktivitas3 <- matrix(aktivi3, ncol = length(ef$sp), byrow = T)
colnames(aktivitas3) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(aktivitas3) <- eval(as.name(paste(asd2[i])))
}
#7
{
for (j in 1:length(eval(as.name(paste(asd4[i]))))) {
if (eval(as.name(paste(asd[i])))[[j]]$adatok$telj_fsz != 0) {
write.xlsx(eval(as.name(paste(asd[i])))[[j]]$fajok, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = eval(as.name(paste(asd3[i])))[j]$regio, append = TRUE, showNA = F)
}
}
write.xlsx(eval(as.name(paste(asd3[i]))), file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Regionkenti adatok', append = TRUE, showNA = F)
write.xlsx(aktivitas, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkent gyujtott egyedek', append = TRUE, showNA = F)
write.xlsx(aktivitas1, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti gyujtesi napok szama', append = TRUE, showNA = F)
write.xlsx(aktivitas2, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti fajok szama', append = TRUE, showNA = F)
write.xlsx(ef_m, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtese szama', append = TRUE, showNA = F)
write.xlsx(aktivitas3, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtott egyedek szama', append = TRUE, showNA = F)
} #exportalas
}
} #tabalzatok lekerdezesek
eval(as.name(paste(asd3[1])))[1]$regio
df[1,]
df
{
df <- data.frame(matrix(vector(), 0, 6, dimnames = list(c(), c('regio', 'terulet', 'teles_fajszam', 'korrekcios_fajszam', 'gyujtesi_pontok_sz', 'egyedszam'))), stringsAsFactors=F)
for (i in 1:length(regi_fl)) {
df[i,]$regio <- nevek[i]
df[i,]$terulet <- regi_fl[[i]]$adatok$terulet
df[i,]$teles_fajszam <- regi_fl[[i]]$adatok$telj_fsz
df[i,]$korrekcios_fajszam <- regi_fl[[i]]$adatok$corr_fsz
df[i,]$gyujtesi_pontok_sz <- regi_fl[[i]]$adatok$gyujtesi_pontok_sz
df[i,]$egyedszam <- regi_fl[[i]]$adatok$egyedszam
}
uj_df <- data.frame(matrix(vector(), 0, 6, dimnames = list(c(), c('regio', 'terulet', 'teles_fajszam', 'korrekcios_fajszam', 'gyujtesi_pontok_sz', 'egyedszam'))), stringsAsFactors=F)
for (i in 1:length(uj_regi_fl)) {
uj_df[i,]$regio <- uj_nevek[i]
uj_df[i,]$terulet <- uj_regi_fl[[i]]$adatok$terulet
uj_df[i,]$teles_fajszam <- uj_regi_fl[[i]]$adatok$telj_fsz
uj_df[i,]$korrekcios_fajszam <- uj_regi_fl[[i]]$adatok$corr_fsz
uj_df[i,]$gyujtesi_pontok_sz <- uj_regi_fl[[i]]$adatok$gyujtesi_pontok_sz
uj_df[i,]$egyedszam <- uj_regi_fl[[i]]$adatok$egyedszam
}
} #Statisztikahoz elokeszitjuk az adatokat
df
{
asd <- c('regi_fl', 'uj_regi_fl')
asd2 <- c('nevek', 'uj_nevek')
asd3 <- c('df', 'uj_df')
asd4 <- c('nPolys', 'uj_nPolys')
#eval(as.name(paste(asd[i])))
#lehet olyat is csinalni hogy eval(as.name(paste(asd[1])))[[2]]$adatok
for (i in 1:length(asd)) {
#lekerdezesek
{
#regionkenti egyedek lekerdezese honaponkent
aktivi <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- numeric(12)
for (i in 1:length(x$fajok$datum)) {
d[month(x$fajok[i,]$datum)] <- d[month(x$fajok[i,]$datum)] + x$fajok[i,]$egyed
}
return(d)
}))
aktivitas <- matrix(c(aktivi), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas) <- honapok
rownames(aktivitas) <- eval(as.name(paste(asd2[i])))
#honaponkenti gyujtesi napok szama regionkent
aktivi1 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- unique(x$fajok$datum)
d <- numeric(12)
for (i in 1:length(d1)) {
d[month(d1[i])] <- d[month(d1[i])] + 1
}
return(d)
}))
aktivitas1 <- matrix(c(aktivi1), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas1) <- honapok
rownames(aktivitas1) <- eval(as.name(paste(asd2[i])))
#honaponkenti fajok szama regionkent
aktivi2 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- data.frame(d = month(x$fajok$datum), f = x$fajok$sp)
d1 <- unique(d1[,c(1,2)])
d <- numeric(12)
for (i in 1:length(d1[,2])) {
d[month(d1[i, 1])] <- d[month(d1[i, 1])] + 1
}
return(d)
}))
aktivitas2 <- matrix(c(aktivi2), nrow = length(eval(as.name(paste(asd2[i])))), byrow = T)
honapok <- c('jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec')
colnames(aktivitas2) <- honapok
rownames(aktivitas2) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtese szama regionkent
#aa <- ddply(eval(as.name(paste(asd[i])))[[2]]$fajok, .(sp), nrow)
ef <- unique(dat[,6:13])
ef_m <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d <- ddply(x$fajok, .(sp), nrow)
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(d$sp) != 0) {
for (i in 1:length(d$sp)) {
d1[1,paste(d$sp[i])] <- d$V1[i]
}
}
return(d1)
}))
ef_m <- matrix(ef_m, ncol = length(ef$sp), byrow = T)
colnames(ef_m) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(ef_m) <- eval(as.name(paste(asd2[i])))
#fajok szerinti gyujtott egyedek szama
ef <- unique(dat[,6:13])
aktivi3 <- unlist(lapply(eval(as.name(paste(asd[i]))), function(x) {
d1 <- matrix(rep(0, nrow(ef)), nrow = 1)
colnames(d1) <- ef$sp
if (length(x$fajok$sp) != 0) {
for (i in 1:length(x$fajok$sp)) {
d1[1,paste(x$fajok$sp[i])] <- d1[1,paste(x$fajok$sp[i])] + x$fajok[i,]$egyed
}
}
return(d1)
}))
aktivitas3 <- matrix(aktivi3, ncol = length(ef$sp), byrow = T)
colnames(aktivitas3) <- paste(ef$fam, ' ', ef$subfam, ' ', ef$gen, ' ', ef$subgen, ' ', ef$spec, ' ', ef$subspec)
rownames(aktivitas3) <- eval(as.name(paste(asd2[i])))
}
#7
{
for (j in 1:length(eval(as.name(paste(asd4[i]))))) {
if (eval(as.name(paste(asd[i])))[[j]]$adatok$telj_fsz != 0) {
write.xlsx(eval(as.name(paste(asd[i])))[[j]]$fajok, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = eval(as.name(paste(asd3[i])))[j,]$regio, append = TRUE, showNA = F)
}
}
write.xlsx(eval(as.name(paste(asd3[i]))), file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Regionkenti adatok', append = TRUE, showNA = F)
write.xlsx(aktivitas, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkent gyujtott egyedek', append = TRUE, showNA = F)
write.xlsx(aktivitas1, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti gyujtesi napok szama', append = TRUE, showNA = F)
write.xlsx(aktivitas2, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Honaponkenti fajok szama', append = TRUE, showNA = F)
write.xlsx(ef_m, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtese szama', append = TRUE, showNA = F)
write.xlsx(aktivitas3, file = paste("tipulidae_eredmenyek_", paste(asd[i]), ".xlsx", sep = ""), sheetName = 'Fajok szerinti gyujtott egyedek szama', append = TRUE, showNA = F)
} #exportalas
}
} #tabalzatok lekerdezesek
{
OBM_init('transdiptera')
tokeRn <- OBM_auth('veres_robi75@yahoo.com', '123456')
t_data <- OBM_get('get_data', '*')
t_data <- data.frame(t_data)
t_data[, 2:8] <- NULL #kivesz egy par oszlopot
regi <- readOGR("/home/robi/Allamvizsga/Qgis/Regiune/Regiune.shp", layer = "Regiune")
rom <- readOGR("/home/robi/Allamvizsga/Qgis/Subregiune/Romania_teljes.shp", layer = "Romania_teljes")
tipuloidae <- read_excel("~/Allamvizsga/Fajlista_teljes.xlsx", sheet = "Tipulidae")
regi <- readOGR("/home/robi/Allamvizsga/Qgis/Regiune/Regiune.shp", layer = "Regiune")
uj_regi <- readOGR("/home/robi/Allamvizsga/Qgis/uj regio hatarok/2.shp")
id <- unlist(t_data$obm_id)
la <- unlist(t_data$latitude)
lo <- unlist(t_data$longitude)
sp <- unlist(t_data$species_id)
datum <- as.POSIXlt(unlist(t_data$collection_date))
egyed <- unlist(t_data$males) + unlist(t_data$females)
dat <- data.frame(id = id, lon = lo, lat = la, egyed = egyed, datum = datum, fam = NA, subfam = NA, gen = NA, subgen = NA, spec = NA, subspec = NA, auth = NA, sp = sp)
} #kiindulasi adatok lekerdezese
{
OBM_init('transdiptera')
tokeRn <- OBM_auth('veres_robi75@yahoo.com', '123456')
t_data <- OBM_get('get_data', '*')
t_data <- data.frame(t_data)
t_data[, 2:8] <- NULL #kivesz egy par oszlopot
regi <- readOGR("/home/robi/Allamvizsga/Qgis/Regiune/Regiune.shp", layer = "Regiune")
rom <- readOGR("/home/robi/Allamvizsga/Qgis/Subregiune/Romania_teljes.shp", layer = "Romania_teljes")
tipuloidae <- read_excel("~/Allamvizsga/Fajlista_teljes.xlsx", sheet = "Tipulidae")
regi <- readOGR("/home/robi/Allamvizsga/Qgis/Regiune/Regiune.shp", layer = "Regiune")
uj_regi <- readOGR("/home/robi/Allamvizsga/Qgis/uj regio hatarok/2.shp")
id <- unlist(t_data$obm_id)
la <- unlist(t_data$latitude)
lo <- unlist(t_data$longitude)
sp <- unlist(t_data$species_id)
datum <- as.POSIXlt(unlist(t_data$collection_date))
egyed <- unlist(t_data$males) + unlist(t_data$females)
dat <- data.frame(id = id, lon = lo, lat = la, egyed = egyed, datum = datum, fam = NA, subfam = NA, gen = NA, subgen = NA, spec = NA, subspec = NA, auth = NA, sp = sp)
} #kiindulasi adatok lekerdezese
{
a <- numeric(0)
for (i in 1:length(dat$sp)) {
x <- match(dat[i, ]$sp, tipuloidae$taxon_id)
if (!is.na(x)) {
dat[i, ]$fam <- tipuloidae[x, ]$family
dat[i, ]$subfam <- tipuloidae[x, ]$subfamily
dat[i, ]$gen <- tipuloidae[x, ]$genera
dat[i, ]$subgen <- tipuloidae[x, ]$subgenera
dat[i, ]$spec <- tipuloidae[x, ]$species
dat[i, ]$subspec <- tipuloidae[x, ]$subspecies
dat[i, ]$auth <- tipuloidae[x, ]$author
} else {
a[length(a) + 1] <- i
}
}
dat <- dat[-a,]
} #kiszurjuk a Tipulidae adatokat es beszurjuk a besorolast
{
new_shape_1 <-
point.in.polygon(
dat$lon,
dat$lat,
rom@polygons[[1]]@Polygons[[1]]@coords[, 1],
rom@polygons[[1]]@Polygons[[1]]@coords[, 2]
)
a <- numeric(0)
for (i in 1:length(new_shape_1)) {
if (new_shape_1[i] == 0) {
a[length(a) + 1] = i
}
}
dat <- dat[-a, ]
} #kiszurjuk azokat az adatokat, amelyek Romaniaba vannak
regi_f <- fortify(regi)
nPolys <- unique(regi_f$id) #a kulombozo regioknak az azonositoi, osszesen 16
regi_fl = list()
nevek <- numeric(length(nPolys))
for (i in 1:length(nPolys)) {
nevek[i] <- as.character(regi$Megnevezes[i])
}
nevek
